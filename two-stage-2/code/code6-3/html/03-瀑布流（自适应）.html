<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        * {
            margin: 0;
            padding: 0;
        }

        .box {
            width: 100%;
            position: relative;
        }

        .box div {
            width: 100px;
            /* line-height: 50px;
            height: 50px; */
            margin: 10px;
            text-align: center;
            position: absolute;
        }
    </style>
    <script src="../js/jquery-3.4.1.js"></script>
    <script src="../js/jquery-random.js"></script>
</head>

<body>
    <div class="box"></div>
    <script>
        $(function () {
            // 生成子标签
            for (let i = 0; i < 300; i++) {
                // 生成子标签
                let itme = $(`<div>${i + 1}</div>`);
                itme.addClass("itme");
                // 高度随机
                let timeHeight = $.getRandomNumber(30,200) + "px"
                itme.css({
                   "height":timeHeight,
                    "line-height":timeHeight
                })
                // 设置样式
                itme.css("background", $.getRandomColor());
                // 插入页面
                $(".box").append(itme);
            };

            // 设置  top left  的值
            let margin = 10;
            let oItme = $(".itme");
            let itmeWidth = oItme.width();
            let itmeHeight = oItme.height();

            // 封装方法
            function Waterfall() {
                
                // 当前页面行能够容纳都少个标签(标签宽度和margin)
                let len = Math.floor($(window).width() / (itmeWidth + margin));
                let itmeArr = [];
                oItme.each(function (i, ele) {
                    // 当前标签的宽度
                    let offsetTop = $(this).height();
                    
                    // 标签所在的行和列
                    let itmeLine = Math.floor(i / len);
                    let itmeColumn = i % len;
                     // top left计算公式
                        let itmeTop  = margin + itmeLine * (margin + itmeHeight);
                        let itmeLeft = margin + itmeColumn * (margin + itmeWidth);
                    // 判断在第多少行
                    if(itmeLine == 0){
                        itmeArr.push({left:itmeLeft,top:margin + offsetTop});
                        
                         // 设置top left 可用css样式，或者自定义动画
                        $(this).css({
                            "left": itmeLeft + "px",
                            "top": itmeTop + "px"
                        });       
                    }else{
                        let minIndex = $.getMinIndexWithArr(itmeArr);
                        let offleft = itmeArr[minIndex].left;
                        let offtop  = itmeArr[minIndex].top + margin;
                        
                        $(this).css({
                            "left": offleft + "px",
                            "top": offtop + "px"
                        });  
                        // 更新数据
                        itmeArr[minIndex].top = offtop + offsetTop;
                    }
             
                })
            };

            // 调用方法
            Waterfall();

            // 监听页面变化时做出改变
            $(window).resize(function () {
                Waterfall();
            })
        })
    </script>
</body>

</html>